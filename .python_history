import wx
import loguru
import transformers, pandas as pd
df = pd.read_csv("O-M-codes_2024-05-13_seed-42_train.csv", sep="|", escapechar="\\")
tokenizer = transformers.AutoTokenizer("bert-base-uncased")
tokenizer = transformers.AutoTokenizer. from_pretrained("bert-base-uncased")
import matplotlib.pyplot as plt
tokenizer = AutoTokenizer.from_pretrained("smanjil/German-MedBERT")
tokenizer = transformers.AutoTokenizer.from_pretrained("smanjil/German-MedBERT")
df["tokenized_diagnosis"] = df["diagnoses_concat"].apply(lambda x: tokenizer.tokenize(x))
df.tokenized_diagnosis.value_counts().plot(kind = "barh")
plt.show()
matplotlib.use('qtagg')
import matplotlib
matplotlib.use('qtagg')
matplotlib.use('GTK3Agg')
plt.save("counts.png")
plt.savefig("lengths.png")
df.tokenized_diagnosis.iloc[0]
df.tokenized_diagnosis.iloc[0].length
len(df.tokenized_diagnosis.iloc[0])
df["tokenized_diagnosis_len"] = df["tokenized_diagnosis"].apply(lambda x: len(x))
import transformers
pipe = transformers.pipeline(model="jbochi/madlad400-3b-mt")
from code_embeddings.code_crawlers.spiders.gesund import IcdsSpider
from code_embeddings.code_crawler.spiders.gesund import IcdsSpider
spider = IcdsSpider
spider = IcdsSpider()
spider.start_urls
spider.start_requests
list(spider.start_requests)
list(spider.start_requests())
import random
random.shuffle([1,2,3,4,5,6,7,8,9,10])
l = [1,2,3,4,5,6,7,8,9,10]
random.shuffle(l)
l
import json
obj json.loads("{'hospitalId': '261300129', 'tenantId': 'PHD', 'caseId': '2033192@261300129', 'lastDepartmentId': 'HA2316', 'lastDepartmentName': 'Orthopädie und Unfallchirurgie (Hauptabteilung)', 'admission': {'cause': 'E', 'date': '2020-11-10T05:00:00Z', 'mode': '0101'}, 'discharge': {'date': '2020-11-21T10:24:00Z', 'mode': '099'}, 'age': {'years': 68}, 'sex': 'male', 'mechanicalVentilationDurationInHours': 0, 'intensiveCare': False, 'texts': [{'medicalReportCategory': 'text_other', 'created': '2020-11-10T12:20:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'Detailfragestellung: OP-Vorbereitung bitte mit Kugel röntgen\n\nrechtfertigende Indikation/Klinik: Gonarthrose links\n\nUntersuchungen:\n1. Ganzbein links ap vom 10.11.2020 11:17 - (GANZBEINAPL)\n2. Knie lang stehend links 2 Ebenen vom 10.11.2020 11:23 - (KNIELST2EL)\n3. Patella axial links vom 10.11.2020 11:27 - (PATAXL)\n4. Thorax stehend 2 Ebenen pa + Links seitlich vom 10.11.2020 11:29 - (THSEITLPA2E)\n\nBefund:\n\nLinke Patella tangential\nKorrekte Lage der Patella. Keine Fraktur. Gering ausgeprägte arthrotische Veränderungen an \nder Rückfläche der Patella.\n\nLinkes Knie in zwei Ebenen stehend\nMedial betonte Gonarthrose Grad II. Keine Fraktur. Keine Luxation. Keine großen Osteolysen. \nGelenkerguss.\n\nGanzbeinaufnahme links im Stehen\nDie Mikulicz Linie läuft ca. 3 cm medial vom Mittelpunkt des Tibiakopfes.\n\nThorax in zwei Ebenen\nReguläre Darstellung des Herzens. Keine Stauung. Keine frischen Infiltrationen oder Rundherde.\nKein Pleuraerguss.', 'documentId': '2033192@261300129_17927079', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'cardiac_catheterization', 'created': '2020-11-10T19:31:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'PROC (PROC):   \nHF (HF): 90 /min \nBD sys: (BPsys):  mmHg \nBD dia: (BPdia):  mmHg \nQRS (QRS_D): 72 ms \nQT (QT_D): 336 ms \nQTc (QTC_D): 411 ms \nPQ (PQ_D): 178 ms \nP (P_D): 116 ms \nRR (RR_D): 666 ms \nPP (PP_D): 665 ms \nQTc-Berechnung (QTC_BE): 1  \n<P (P_WI): 62 Grad \n<QRS (QRS_WI): 48 Grad \n<T (T_WI): 67 Grad \nSystemauswertung (INTER):   normaler Sinusrhythmus\n  Normal-EKG\n  \n\nBemerkung (BEMERK):   \n\nBlutdruck [mmHg] (BP):   --/--', 'documentId': '2033192@261300129_17927484', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'operation', 'created': '2020-11-12T13:10:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'O P E R A T I O N S B E R I C H T\n\nName:\nJohannsen\nOperateur:\nDr. med. Rimkus, Frank \n\nVorname:\nThomas\nAssistenz:\nDr. med. Hanebeck, Jan\nAlaliwy, Hamoud\n\ngeb. am:\n31.10.1952\nOP-Pflege.:\nBrink,Marit\n\nStation:\nStation 2C\nAnästhesie:\nWallas,Frank\n\nOP-Saal:\n2Saal 3\nAnästhesiepflege:\nKronberger,Daniela\nPritz,Christin\nRepenthin,Janine\n\nNarkose:\nSpinalanästhesie (single shot)\nLagerungsart:\nRücken\n\nOP am:\n11.11.2020\nSchnitt-Naht-Zeit\n11:15 - 12:40\n\n\nPräoperative Diagnosen:\nVarusgonarthrose links\n\nOperation:\nImplantation einer Hybrid-Knie-TEP links \n(Firma Mathys, Typ balansys bicondylär: Femur Gr. C, PS Tibia Gr. 70, vitamys\nCR Inlay Gr.  8mm) \n\nOperationsbeurteilung: \nBei dem Patienten liegt eine röntgenologisch gesicherte Varusgonarthrose links\nvor. Der Patient klagt über konservativ-therapieresistente Schmerzen im\nKniegelenk. Aus diesem Grunde wurde die Indikation zur o.g. Operation gestellt.\nDer Patient wurde präoperativ eingehend über das operative Verfahren sowie alle\n Risiken einschließlich Infektion, Implantatlockerung, Gefäß- und\nNervenverletzung mit anschließender Lähmung, Durchblutungsstörungen,\nLagerungsschäden, Abnutzung des künstlichen Kniegelenkersatzes, Patellafraktur,\nPatellaluxation und alle weiteren Risiken aufgeklärt. Der Patient war in allen\nPunkten mit dem operativen Vorgehen einverstanden.\n\nVerlauf: \nZirka 15 cm langer Hautschnitt über dem linken Kniegelenk. Instrumentenwechsel.\nDurchtrennung des subkutanen Fettgewebes bis auf die Gelenkkapsel.\nParapatellare Eröffnung der Gelenkkapsel. Erweiterung der Inzision mit der\nPräparierschere nach kranial und kaudal 1 cm vom Innenrand der Patella\nentfernt. Zurückschlagen der Patella und Überführung des Kniegelenkes in 90°\nBeugung. Entfernung der Randosteophyten und Teilsynovektomie. Darstellung der\nFossa intercondylaris sowie der Eminentia intercondylaris. Zentrierung der\nMarkraumbohrlehre entsprechend der Kniegelenksachse im Bereich der Eminentia\nintercondylaris. Es erfolgt die Eröffnung der Tibiamarkhöhle mit dem 8 mm\nMarkraumbohrer. Der intramedulläre Führungsstab wird in die Tibiamarkraumhöhle\neingeschoben. Positionierung der Tibiaresektionslehre unter Beachtung der\nRotation. Die Rotation wird nach der Tuberositas tibiae korrekt ausgerichtet.\nFixation der Resektionslehre mit Haltestiften. Einstellung der Resektionshöhe\nund des entsprechenden Tibia slope. Durchführung der proximalen Tibiaresektion\nunter Seitenbandschutz. Durchführung der Größenbestimmung des Tibiaplateaus.\nNun erfolgt die Eröffnung der Femurmarkhöhle mit dem 8 mm Markraumbohrer ca. 1\ncm ventral des Ansatzes für das hintere Kreuzband und entsprechend der\nKniegelenksachse. Der intramedulläre Femurführungsstab wird in die Femurhöhle\neingeschoben. Positionierung der distalen Femurresektionslehre, die bis zum\nkondylen Kontakt vorgeschoben wird. Die Rotation wird korrekt ausgerichtet.\nFixation der Resektionslehre mit Haltestiften. Nun erfolgt die distale\nFemurresektion entlang des Resektionsblockes. Danach erfolgt das Aufsetzen der\nPositionierungshilfe für den Femurresektionsblock. Entsprechend der Größe des\nTibiaplateaus wird nun die Größe der Femurprothese bestimmt. Durchführen der\nentsprechenden Bohrungen für die Femurresektionslehre. Aufsetzen der\nentsprechenden 4 in 1 Femurresektionslehre. Durchführung der entsprechenden\nFemurresektionsschnitte. Danach erfolgt eine Synovektomie des dorsalen\nRecessus. Dorsale Randosteophyten werden entfernt. Nun erfolgen das Einbringen\nder Tibiaprobekomponente sowie das Einsetzen eines Probeinlays. Einsetzen der\nFemurprobekomponente und Überführung des Kniegelenkes in volle Streckung.\nÜberprüfung der Femurachse und der Bandstabilität. Die Rotationsverhältnisse\nsind korrekt und die Bandstabilität ist gegeben. Darstellung der\nPatellarückfläche. Hier zeigen sich noch gute Knorpelverhältnisse, sodass eine\nDenervierung parapatellar durchgeführt wird. Umsetzen des Kniegelenkes in 90°\nBeugestellung. Entfernung aller Probekomponenten. Ausgiebige Spülung mit der\nJet-Lavage. Einzementieren der entsprechenden Tibiakomponente. Entfernen der\nKnochenzementreste. Aushärten des Knochenzementes. Einsetzen des definitiven\nPE-Plateaus. Nun erfolgt das Einbringen der definitiven Femurprothese in\nzementfreier Technik. Danach wird das Kniegelenk in volle Streckung überführt.\nFunktionsprobe. Regelrechter Lauf der Prothese bei guter Bandstabilität.\nKräftige Spülung. Eröffnung der Blutleere. Blutstillung. Schichtweiser\nWundverschluss über 1 Redon-Drainage. \nBei der Kontrolle auf Wachstation sind Motorik, Sensibilität und Durchblutung\nintakt. Die Nachbehandlung kann planmäßig durchgeführt werden.\n\n\nDr. med. Rimkus, Frank \nOperateur', 'documentId': '2033192@261300129_17930487', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'text_other', 'created': '2020-11-18T08:47:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'Detailfragestellung: post-OP Kontrolle\n\nrechtfertigende Indikation/Klinik: Z. n. Knie-TEP\n\nUntersuchungen:\n1. CD brennen vom 18.11.2020 09:39 - (CDBRENNEN)\n2. Ganzbein links ap vom 18.11.2020 09:22 - (GANZBEINAPL)\n3. Knie links 2 Ebenen vom 18.11.2020 09:35 - (KNIE2EL)\n4. Patella axial links vom 18.11.2020 09:36 - (PATAXL)\n\nBefund:\n\nLinke Patella tangential\nKorrekte Lage der Patella. Keine Fraktur. Zustand nach Knie-TEP-Implantation.\n\nLinkes Knie in zwei Ebenen stehend\nZustand nach Knie-TEP-Implantation. Regulärer postoperativer Befund.\n\nGanzbeinaufnahme links im Stehen\nDie Mikulicz Linie läuft ca. 1 cm medial vom Mittelpunkt des Tibiakopfes.', 'documentId': '2033192@261300129_17936657', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'referral_letter', 'created': '2020-11-20T13:49:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'Krankenhaus Hagenow - Parkstr. 12 - 19230 Hagenow\n\nHerrn \nDr. med. Andreas Hensel\nLübecker Str. 36\n19053 Schwerin\n\n\n\n\n\n\n\nNachrichtlich an:\nCarola Lunau, Leezen\nReha MEDIAN-Klinik Wismar, Wismar, Meckl\n\n\n\n\n\n\nIhre Zeichen\nIhre Nachricht vom\nUnsere Zeichen\nDatum\n\n\n\n2033192\n20.11.2020\n\n\nPat.: Johannsen, Thomas, geb. am 31.10.1952, wh. in 19067 Leezen, Adlerstraße 2\n\n\nSehr geehrter Herr Dr. med. Hensel,\n\noben genannter Patient befand sich vom 10.11.2020 bis zum 21.11.2020 in unserer\nstationären Behandlung.\n\n\nDiagnose:\nVarusgonarthrose links\n\n\n\nArt. Hypertonie\n\nTherapie:\nOP am 11.11.2020: Implantation einer Hybrid-Knie-TEP links \n(Firma Mathys, Typ balansys bicondylär: Femur Gr. C, PS Tibia Gr. 70, vitamys\nCR Inlay Gr.  8mm)\n\n\n\n\nDie stat. Aufnahme des Pat erfolgte zur geplanten OP. Der Patient klagt seit\n2013 über belastungsabhängige zunehmende Schmerzen im Bereich des linken\nKniegelenkes. Seit Anfang des Jahres würden diese Beschwerden erheblich\nzunehmen. Die Gehstrecke und die Lebensqualität des Patienten werden dadurch\nerheblich beeinträchtigt.\n\nZum Untersuchungszeitpunkt kann das linke Kniegelenk bis 100° schmerzhaft\ngebeugt werden. Es besteht ein deutlicher Druckschmerz im Bereich des medialen\nKompartimentes. Das Zeichen nach Zohlen ist leicht positiv. Es besteht eine\nmittelgradige femoropatellare Krepitation.\n\nRadiologisch stellte sich im konventionellen Röntgen folgender Befund dar:\nLinke Patella tangential: Korrekte Lage der Patella. Keine Fraktur. Gering\nausgeprägte arthrotische Veränderungen an der Rückfläche der Patella.\nLinkes Knie in zwei Ebenen stehend: Medial betonte Gonarthrose Grad II. Keine\nFraktur. Keine Luxation. Keine großen Osteolysen. Gelenkerguss.\nGanzbeinaufnahme links im Stehen: Die Mikulicz Linie läuft ca. 3 cm medial vom\nMittelpunkt des Tibiakopfes.\n\nKlinischer Verlauf:\nWir führten nach entsprechender Vorbereitung o.g. Eingriff am 11.11.2020\nkomplikationslos durch. Der Patient tolerierte den Eingriff kardiopulmonal gut.\nDer weitere Verlauf hinsichtlich Wundheilung, Kostaufbau und Remobilisation\ngestaltete sich regelrecht. Wir verabreichten eine bedarfsgerechte Analgesie\nund begannen mit physiotherapeutischer Beübung und Mobilisation. Herr Johannsen\nkonnte unter zügiger Vollbelastung des operierten Beins an UA-Gehstützen auf\nStationsebene inclusive Treppensteigen sukzessive remobilisiert werden. \nDie Wundheilung verlief per primam, die intraoperativ gelegte Redondrainage\nkonnten jeweils zeitgerecht entfernt werden. Die postoperativ gefertigten\nRö-Kontrollen zeigten eine gute und achsengerechte Lage der Endoprothese. Am\n21.11.2020 konnten wir den Patienten bei gutem Allgemeinbefinden direkt in die\nAnschlussheilbehandlung der Rehaklinik Wismar entlassen.\n\nEntlassungsbefund:\nZum Entlassungszeitpunkt war die Wunde reizlos nach Entfernung des\nHautverschlussmaterials. Die periphere Sensomotorik war intakt,\nThrombosezeichen lagen nicht vor. Das Bewegungsausmaß betrug Ex/Flex 0/0/90°,\ndie Gehstrecke ca. 500m an 2 UAGS bei möglicher Vollbelastung des linken Beines.\n\nMedikation Entlassempfehlung vom 20.11.2020\nWirkstoff\nHandelsname\nDosierung\n(morgens-mittags-abends-zur Nacht)Form u. Verabreichungsweg\nIntervall\nKommentar\n\nVerapamil hydrochlorid 120 mg Retard-Tabletten\nVeraHEXAL KHK 120mg retard\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nIrbesartan und Hydrochlorothiazid 300 mg + 25 mg Filmtabletten\nIrbesartan/HCT STADA 300mg/25mg\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nPantoprazol 40 mg Tabletten magensaftresistent\nPantozol 40mg\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nMacrogol, Kombinationen kombi Pulver zur Herstellung einer Lösung zum Einnehmen\nMOVICOL\n1 - 1 - 0 Beutel\ntäglich (aktiv)\n \n\nKalium-Ion 40 mmol Brausetabletten\nKalinor\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nEnoxaparin natrium 40 mg/0,4 ml Injektionslösung\nClexane 4000I.E. (40mg)/0,4ml Injektionslsg. m.Sich-Sys.\n1 - 0 - 0 Spritze\ntäglich (aktiv)\n \n\nMetamizol natrium-1-Wasser 500 mg Filmtabletten\nNovaminsulfon 500-1A Pharma\n2 - 2 - 2 - 2 Tabl.\ntäglich (aktiv)\n \n\nDie verordnete Therapie kann aus unserer Sicht gegen Präparate anderer\nHersteller mit dem gleichen internationalen Freinamen für den Wirkstoff,\ngleicher Dosis und identischer Galenik ausgetauscht werden.\n\n\nTherapieempfehlung:\nWir empfehlen die weitere intensive physiotherapeutische Mobilisation und\nBeübung sowie regelmäßige Röntgen-, Wund- und Befundkontrollen. Ferner\nempfehlen wir die Fortsetzung der Thromboseprophylaxe entsprechend der\nMobilisation des Pat. für 4 Wochen postop..\n\n\n\nMit freundlichen Grüßen\n\n\n\nDr. med. F. Rimkus\nChefarzt\nDr. med. J. Hanebeck\nOberarzt\nH.Alaliwy\nAssistenzarzt', 'documentId': '2033192@261300129_17940590', 'mediaType': 'text/plain'}], 'originalPrincipalDiagnosis': 'M17.1', 'currentPrincipalDiagnosis': 'M17.1', 'originalAdditionalDiagnoses': ['I10.00', 'E87.6'], 'currentAdditionalDiagnoses': ['I10.00', 'E87.6'], 'originalProcedures': ['5-822.g2'], 'currentProcedures': ['5-822.g2'], 'originalGroup': 'I44C', 'currentGroup': 'I44C', 'originalPccl': 0, 'currentPccl': 0, 'originalTotalFee': 8129.99, 'currentTotalFee': 8129.99, 'maxPredictionFee': 8129.99, 'currentState': 'Untouched', 'predictions': {'newPrincipalDiagnoses': [], 'diagnoses': [], 'switchPrincipalDiagnoses': [], 'secondaryDiagnoses': [], 'procedures': [], 'compoundPredictions': []}}")
obj = json.loads("{'hospitalId': '261300129', 'tenantId': 'PHD', 'caseId': '2033192@261300129', 'lastDepartmentId': 'HA2316', 'lastDepartmentName': 'Orthopädie und Unfallchirurgie (Hauptabteilung)', 'admission': {'cause': 'E', 'date': '2020-11-10T05:00:00Z', 'mode': '0101'}, 'discharge': {'date': '2020-11-21T10:24:00Z', 'mode': '099'}, 'age': {'years': 68}, 'sex': 'male', 'mechanicalVentilationDurationInHours': 0, 'intensiveCare': False, 'texts': [{'medicalReportCategory': 'text_other', 'created': '2020-11-10T12:20:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'Detailfragestellung: OP-Vorbereitung bitte mit Kugel röntgen\n\nrechtfertigende Indikation/Klinik: Gonarthrose links\n\nUntersuchungen:\n1. Ganzbein links ap vom 10.11.2020 11:17 - (GANZBEINAPL)\n2. Knie lang stehend links 2 Ebenen vom 10.11.2020 11:23 - (KNIELST2EL)\n3. Patella axial links vom 10.11.2020 11:27 - (PATAXL)\n4. Thorax stehend 2 Ebenen pa + Links seitlich vom 10.11.2020 11:29 - (THSEITLPA2E)\n\nBefund:\n\nLinke Patella tangential\nKorrekte Lage der Patella. Keine Fraktur. Gering ausgeprägte arthrotische Veränderungen an \nder Rückfläche der Patella.\n\nLinkes Knie in zwei Ebenen stehend\nMedial betonte Gonarthrose Grad II. Keine Fraktur. Keine Luxation. Keine großen Osteolysen. \nGelenkerguss.\n\nGanzbeinaufnahme links im Stehen\nDie Mikulicz Linie läuft ca. 3 cm medial vom Mittelpunkt des Tibiakopfes.\n\nThorax in zwei Ebenen\nReguläre Darstellung des Herzens. Keine Stauung. Keine frischen Infiltrationen oder Rundherde.\nKein Pleuraerguss.', 'documentId': '2033192@261300129_17927079', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'cardiac_catheterization', 'created': '2020-11-10T19:31:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'PROC (PROC):   \nHF (HF): 90 /min \nBD sys: (BPsys):  mmHg \nBD dia: (BPdia):  mmHg \nQRS (QRS_D): 72 ms \nQT (QT_D): 336 ms \nQTc (QTC_D): 411 ms \nPQ (PQ_D): 178 ms \nP (P_D): 116 ms \nRR (RR_D): 666 ms \nPP (PP_D): 665 ms \nQTc-Berechnung (QTC_BE): 1  \n<P (P_WI): 62 Grad \n<QRS (QRS_WI): 48 Grad \n<T (T_WI): 67 Grad \nSystemauswertung (INTER):   normaler Sinusrhythmus\n  Normal-EKG\n  \n\nBemerkung (BEMERK):   \n\nBlutdruck [mmHg] (BP):   --/--', 'documentId': '2033192@261300129_17927484', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'operation', 'created': '2020-11-12T13:10:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'O P E R A T I O N S B E R I C H T\n\nName:\nJohannsen\nOperateur:\nDr. med. Rimkus, Frank \n\nVorname:\nThomas\nAssistenz:\nDr. med. Hanebeck, Jan\nAlaliwy, Hamoud\n\ngeb. am:\n31.10.1952\nOP-Pflege.:\nBrink,Marit\n\nStation:\nStation 2C\nAnästhesie:\nWallas,Frank\n\nOP-Saal:\n2Saal 3\nAnästhesiepflege:\nKronberger,Daniela\nPritz,Christin\nRepenthin,Janine\n\nNarkose:\nSpinalanästhesie (single shot)\nLagerungsart:\nRücken\n\nOP am:\n11.11.2020\nSchnitt-Naht-Zeit\n11:15 - 12:40\n\n\nPräoperative Diagnosen:\nVarusgonarthrose links\n\nOperation:\nImplantation einer Hybrid-Knie-TEP links \n(Firma Mathys, Typ balansys bicondylär: Femur Gr. C, PS Tibia Gr. 70, vitamys\nCR Inlay Gr.  8mm) \n\nOperationsbeurteilung: \nBei dem Patienten liegt eine röntgenologisch gesicherte Varusgonarthrose links\nvor. Der Patient klagt über konservativ-therapieresistente Schmerzen im\nKniegelenk. Aus diesem Grunde wurde die Indikation zur o.g. Operation gestellt.\nDer Patient wurde präoperativ eingehend über das operative Verfahren sowie alle\n Risiken einschließlich Infektion, Implantatlockerung, Gefäß- und\nNervenverletzung mit anschließender Lähmung, Durchblutungsstörungen,\nLagerungsschäden, Abnutzung des künstlichen Kniegelenkersatzes, Patellafraktur,\nPatellaluxation und alle weiteren Risiken aufgeklärt. Der Patient war in allen\nPunkten mit dem operativen Vorgehen einverstanden.\n\nVerlauf: \nZirka 15 cm langer Hautschnitt über dem linken Kniegelenk. Instrumentenwechsel.\nDurchtrennung des subkutanen Fettgewebes bis auf die Gelenkkapsel.\nParapatellare Eröffnung der Gelenkkapsel. Erweiterung der Inzision mit der\nPräparierschere nach kranial und kaudal 1 cm vom Innenrand der Patella\nentfernt. Zurückschlagen der Patella und Überführung des Kniegelenkes in 90°\nBeugung. Entfernung der Randosteophyten und Teilsynovektomie. Darstellung der\nFossa intercondylaris sowie der Eminentia intercondylaris. Zentrierung der\nMarkraumbohrlehre entsprechend der Kniegelenksachse im Bereich der Eminentia\nintercondylaris. Es erfolgt die Eröffnung der Tibiamarkhöhle mit dem 8 mm\nMarkraumbohrer. Der intramedulläre Führungsstab wird in die Tibiamarkraumhöhle\neingeschoben. Positionierung der Tibiaresektionslehre unter Beachtung der\nRotation. Die Rotation wird nach der Tuberositas tibiae korrekt ausgerichtet.\nFixation der Resektionslehre mit Haltestiften. Einstellung der Resektionshöhe\nund des entsprechenden Tibia slope. Durchführung der proximalen Tibiaresektion\nunter Seitenbandschutz. Durchführung der Größenbestimmung des Tibiaplateaus.\nNun erfolgt die Eröffnung der Femurmarkhöhle mit dem 8 mm Markraumbohrer ca. 1\ncm ventral des Ansatzes für das hintere Kreuzband und entsprechend der\nKniegelenksachse. Der intramedulläre Femurführungsstab wird in die Femurhöhle\neingeschoben. Positionierung der distalen Femurresektionslehre, die bis zum\nkondylen Kontakt vorgeschoben wird. Die Rotation wird korrekt ausgerichtet.\nFixation der Resektionslehre mit Haltestiften. Nun erfolgt die distale\nFemurresektion entlang des Resektionsblockes. Danach erfolgt das Aufsetzen der\nPositionierungshilfe für den Femurresektionsblock. Entsprechend der Größe des\nTibiaplateaus wird nun die Größe der Femurprothese bestimmt. Durchführen der\nentsprechenden Bohrungen für die Femurresektionslehre. Aufsetzen der\nentsprechenden 4 in 1 Femurresektionslehre. Durchführung der entsprechenden\nFemurresektionsschnitte. Danach erfolgt eine Synovektomie des dorsalen\nRecessus. Dorsale Randosteophyten werden entfernt. Nun erfolgen das Einbringen\nder Tibiaprobekomponente sowie das Einsetzen eines Probeinlays. Einsetzen der\nFemurprobekomponente und Überführung des Kniegelenkes in volle Streckung.\nÜberprüfung der Femurachse und der Bandstabilität. Die Rotationsverhältnisse\nsind korrekt und die Bandstabilität ist gegeben. Darstellung der\nPatellarückfläche. Hier zeigen sich noch gute Knorpelverhältnisse, sodass eine\nDenervierung parapatellar durchgeführt wird. Umsetzen des Kniegelenkes in 90°\nBeugestellung. Entfernung aller Probekomponenten. Ausgiebige Spülung mit der\nJet-Lavage. Einzementieren der entsprechenden Tibiakomponente. Entfernen der\nKnochenzementreste. Aushärten des Knochenzementes. Einsetzen des definitiven\nPE-Plateaus. Nun erfolgt das Einbringen der definitiven Femurprothese in\nzementfreier Technik. Danach wird das Kniegelenk in volle Streckung überführt.\nFunktionsprobe. Regelrechter Lauf der Prothese bei guter Bandstabilität.\nKräftige Spülung. Eröffnung der Blutleere. Blutstillung. Schichtweiser\nWundverschluss über 1 Redon-Drainage. \nBei der Kontrolle auf Wachstation sind Motorik, Sensibilität und Durchblutung\nintakt. Die Nachbehandlung kann planmäßig durchgeführt werden.\n\n\nDr. med. Rimkus, Frank \nOperateur', 'documentId': '2033192@261300129_17930487', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'text_other', 'created': '2020-11-18T08:47:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'Detailfragestellung: post-OP Kontrolle\n\nrechtfertigende Indikation/Klinik: Z. n. Knie-TEP\n\nUntersuchungen:\n1. CD brennen vom 18.11.2020 09:39 - (CDBRENNEN)\n2. Ganzbein links ap vom 18.11.2020 09:22 - (GANZBEINAPL)\n3. Knie links 2 Ebenen vom 18.11.2020 09:35 - (KNIE2EL)\n4. Patella axial links vom 18.11.2020 09:36 - (PATAXL)\n\nBefund:\n\nLinke Patella tangential\nKorrekte Lage der Patella. Keine Fraktur. Zustand nach Knie-TEP-Implantation.\n\nLinkes Knie in zwei Ebenen stehend\nZustand nach Knie-TEP-Implantation. Regulärer postoperativer Befund.\n\nGanzbeinaufnahme links im Stehen\nDie Mikulicz Linie läuft ca. 1 cm medial vom Mittelpunkt des Tibiakopfes.', 'documentId': '2033192@261300129_17936657', 'mediaType': 'text/plain'}, {'medicalReportCategory': 'referral_letter', 'created': '2020-11-20T13:49:00Z', 'modified': '2023-11-25T10:51:39Z', 'content': 'Krankenhaus Hagenow - Parkstr. 12 - 19230 Hagenow\n\nHerrn \nDr. med. Andreas Hensel\nLübecker Str. 36\n19053 Schwerin\n\n\n\n\n\n\n\nNachrichtlich an:\nCarola Lunau, Leezen\nReha MEDIAN-Klinik Wismar, Wismar, Meckl\n\n\n\n\n\n\nIhre Zeichen\nIhre Nachricht vom\nUnsere Zeichen\nDatum\n\n\n\n2033192\n20.11.2020\n\n\nPat.: Johannsen, Thomas, geb. am 31.10.1952, wh. in 19067 Leezen, Adlerstraße 2\n\n\nSehr geehrter Herr Dr. med. Hensel,\n\noben genannter Patient befand sich vom 10.11.2020 bis zum 21.11.2020 in unserer\nstationären Behandlung.\n\n\nDiagnose:\nVarusgonarthrose links\n\n\n\nArt. Hypertonie\n\nTherapie:\nOP am 11.11.2020: Implantation einer Hybrid-Knie-TEP links \n(Firma Mathys, Typ balansys bicondylär: Femur Gr. C, PS Tibia Gr. 70, vitamys\nCR Inlay Gr.  8mm)\n\n\n\n\nDie stat. Aufnahme des Pat erfolgte zur geplanten OP. Der Patient klagt seit\n2013 über belastungsabhängige zunehmende Schmerzen im Bereich des linken\nKniegelenkes. Seit Anfang des Jahres würden diese Beschwerden erheblich\nzunehmen. Die Gehstrecke und die Lebensqualität des Patienten werden dadurch\nerheblich beeinträchtigt.\n\nZum Untersuchungszeitpunkt kann das linke Kniegelenk bis 100° schmerzhaft\ngebeugt werden. Es besteht ein deutlicher Druckschmerz im Bereich des medialen\nKompartimentes. Das Zeichen nach Zohlen ist leicht positiv. Es besteht eine\nmittelgradige femoropatellare Krepitation.\n\nRadiologisch stellte sich im konventionellen Röntgen folgender Befund dar:\nLinke Patella tangential: Korrekte Lage der Patella. Keine Fraktur. Gering\nausgeprägte arthrotische Veränderungen an der Rückfläche der Patella.\nLinkes Knie in zwei Ebenen stehend: Medial betonte Gonarthrose Grad II. Keine\nFraktur. Keine Luxation. Keine großen Osteolysen. Gelenkerguss.\nGanzbeinaufnahme links im Stehen: Die Mikulicz Linie läuft ca. 3 cm medial vom\nMittelpunkt des Tibiakopfes.\n\nKlinischer Verlauf:\nWir führten nach entsprechender Vorbereitung o.g. Eingriff am 11.11.2020\nkomplikationslos durch. Der Patient tolerierte den Eingriff kardiopulmonal gut.\nDer weitere Verlauf hinsichtlich Wundheilung, Kostaufbau und Remobilisation\ngestaltete sich regelrecht. Wir verabreichten eine bedarfsgerechte Analgesie\nund begannen mit physiotherapeutischer Beübung und Mobilisation. Herr Johannsen\nkonnte unter zügiger Vollbelastung des operierten Beins an UA-Gehstützen auf\nStationsebene inclusive Treppensteigen sukzessive remobilisiert werden. \nDie Wundheilung verlief per primam, die intraoperativ gelegte Redondrainage\nkonnten jeweils zeitgerecht entfernt werden. Die postoperativ gefertigten\nRö-Kontrollen zeigten eine gute und achsengerechte Lage der Endoprothese. Am\n21.11.2020 konnten wir den Patienten bei gutem Allgemeinbefinden direkt in die\nAnschlussheilbehandlung der Rehaklinik Wismar entlassen.\n\nEntlassungsbefund:\nZum Entlassungszeitpunkt war die Wunde reizlos nach Entfernung des\nHautverschlussmaterials. Die periphere Sensomotorik war intakt,\nThrombosezeichen lagen nicht vor. Das Bewegungsausmaß betrug Ex/Flex 0/0/90°,\ndie Gehstrecke ca. 500m an 2 UAGS bei möglicher Vollbelastung des linken Beines.\n\nMedikation Entlassempfehlung vom 20.11.2020\nWirkstoff\nHandelsname\nDosierung\n(morgens-mittags-abends-zur Nacht)Form u. Verabreichungsweg\nIntervall\nKommentar\n\nVerapamil hydrochlorid 120 mg Retard-Tabletten\nVeraHEXAL KHK 120mg retard\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nIrbesartan und Hydrochlorothiazid 300 mg + 25 mg Filmtabletten\nIrbesartan/HCT STADA 300mg/25mg\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nPantoprazol 40 mg Tabletten magensaftresistent\nPantozol 40mg\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nMacrogol, Kombinationen kombi Pulver zur Herstellung einer Lösung zum Einnehmen\nMOVICOL\n1 - 1 - 0 Beutel\ntäglich (aktiv)\n \n\nKalium-Ion 40 mmol Brausetabletten\nKalinor\n1 - 0 - 0 Tabl.\ntäglich (aktiv)\n \n\nEnoxaparin natrium 40 mg/0,4 ml Injektionslösung\nClexane 4000I.E. (40mg)/0,4ml Injektionslsg. m.Sich-Sys.\n1 - 0 - 0 Spritze\ntäglich (aktiv)\n \n\nMetamizol natrium-1-Wasser 500 mg Filmtabletten\nNovaminsulfon 500-1A Pharma\n2 - 2 - 2 - 2 Tabl.\ntäglich (aktiv)\n \n\nDie verordnete Therapie kann aus unserer Sicht gegen Präparate anderer\nHersteller mit dem gleichen internationalen Freinamen für den Wirkstoff,\ngleicher Dosis und identischer Galenik ausgetauscht werden.\n\n\nTherapieempfehlung:\nWir empfehlen die weitere intensive physiotherapeutische Mobilisation und\nBeübung sowie regelmäßige Röntgen-, Wund- und Befundkontrollen. Ferner\nempfehlen wir die Fortsetzung der Thromboseprophylaxe entsprechend der\nMobilisation des Pat. für 4 Wochen postop..\n\n\n\nMit freundlichen Grüßen\n\n\n\nDr. med. F. Rimkus\nChefarzt\nDr. med. J. Hanebeck\nOberarzt\nH.Alaliwy\nAssistenzarzt', 'documentId': '2033192@261300129_17940590', 'mediaType': 'text/plain'}], 'originalPrincipalDiagnosis': 'M17.1', 'currentPrincipalDiagnosis': 'M17.1', 'originalAdditionalDiagnoses': ['I10.00', 'E87.6'], 'currentAdditionalDiagnoses': ['I10.00', 'E87.6'], 'originalProcedures': ['5-822.g2'], 'currentProcedures': ['5-822.g2'], 'originalGroup': 'I44C', 'currentGroup': 'I44C', 'originalPccl': 0, 'currentPccl': 0, 'originalTotalFee': 8129.99, 'currentTotalFee': 8129.99, 'maxPredictionFee': 8129.99, 'currentState': 'Untouched', 'predictions': {'newPrincipalDiagnoses': [], 'diagnoses': [], 'switchPrincipalDiagnoses': [], 'secondaryDiagnoses': [], 'procedures': [], 'compoundPredictions': []}}")
cases = json.load("DATA/case-exports/export_cases_2024-06-04_HVB_DEV.json")
cases = json.load(open("DATA/case-exports/export_cases_2024-06-04_HVB_DEV.json"))
first = cases[0]
cases
first = cases["items"][0]
first.get("caseId")
first.get("tenantId")
first.get("hospitalId")
first.get("currentPrincipalDiagnosis")
first.get("currentDiagnoses")
path = "export_cases_2024-06-04_HVB_DEV.json"
import pandas
a = "R11.2"
a.startswith(["R", "M", "O"])
a.startswith(("R", "M", "O"))
from transformers import AutoTokenizer
t = AutoTokenizer.from_pretrained("allenai/Longformer")
t = AutoTokenizer.from_pretrained("/home/benjamin/code/analytics-principal-diagnosis-predictor-research/train.sh")
t = AutoTokenizer.from_pretrained("LennartKeller/longformer-gottbert-base-8192-aw512")
t = AutoTokenizer.from_pretrained("LennartKeller/longformer-gottbert-base-8192-aw512", legacy=False)
res = t("This is a test text. I dont really care what it says", add_special_tokens=True, padding=True, truncation=True, return_tensors="pt")
res
res = t("This is a test text. I dont really care what it says", add_special_tokens=True, padding="max_length", truncation=True, return_tensors="pt")
res
import accelerate
from accelerate import AcceleratorConfig
import torch
t = torch.FloatTensor([1])
t.item()
t.mean().item()
import datetime
datetime.now(tz=timezone.utc).strftime("%Y-%m-%d")
from datetime import datetime
datetime.now(tz=timezone.utc).strftime("%Y-%m-%d")
from datetime import timezone
datetime.now(tz=timezone.utc).strftime("%Y-%m-%d")
datetime.now(tz=timezone.utc).strftime("%Y-%m-%d-%h")
datetime.now(tz=timezone.utc).strftime("%Y-%m-%d-%H")
datetime.now(tz=timezone.utc).strftime("%Y-%m-%d_%H-%M-%S")
datetime.now(tz=timezone.gmt).strftime("%Y-%m-%d_%H-%M-%S")
datetime.now(tz=timezone.utc).strftime("%Y-%m-%d_%H-%M-%S")
import math
[int(math.ceil(math.log(_))) for _ range (0,12)]
[int(math.ceil(math.log(_))) for _ in range (0,12)]
[int(math.ceil(math.log(_))) for _ in range (1,12)]
[int(math.ceil(math.log(_)))+1 for _ in range (1,12)]
import mlflow
mlflow.set_tracking_uri("https://mlflow.apps.ros.service.rhs.zz:443")
client = mlflow.MlflowClient("https://mlflow.apps.ros.service.rhs.zz:443")
for rm in client.search_registered_models():
	print(dict(rm))
import mlflow
import pprint
client = mlflow.MlflowClient("https://mlflow.apps.ros.service.rhs.zz:443")
for rm in client.search_registered_models():
	pprint.pprint(dict(rm), indent=4)
mlflow.transformers.load_model("models:/principal-diagnosis@dev", return_type="components", device="cpu")
mlflow.set_tracking_uri("https://mlflow.apps.ros.service.rhs.zz:443")
mlflow.transformers.load_model("models:/principal-diagnosis@dev", return_type="components", device="cpu")
import pandas as pd
df = pd.read_csv(open("icd10gm2024alpha_edvtxt_20230929.txt"), sep="|")
df.columns
df = pd.read_csv(open("icd10gm2024alpha_edvtxt_20230929.txt"), sep="|", header=["type", "sfarm", "print", "primary", "star", "extra", "primary2", "text"])
df = pd.read_csv(open("icd10gm2024alpha_edvtxt_20230929.txt"), sep="|", header=Nonem, names=["type", "sfarm", "print", "primary", "star", "extra", "primary2", "text"])
df = pd.read_csv(open("icd10gm2024alpha_edvtxt_20230929.txt"), sep="|", header=None, names=["type", "sfarm", "print", "primary", "star", "extra", "primary2", "text"])
df.head()
df.head(50)
